<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã¾ã„ã¾ã„ã® ã»ã—ãã‚‰å·¥æˆ¿</title>
    <link rel="stylesheet" href="game.css">
</head>

<body>

    <div id="main-wrapper">

        <div id="game-container">
            <canvas id="game-canvas"></canvas>

            <!-- ã‚¹ãƒ†ãƒ¼ã‚¸é·ç§»æ¼”å‡º -->
            <div id="screen-transition">
                <div id="location-name">ã»ã—ã‚ã‹ã‚Šã®æ£®</div>
            </div>

            <!-- ã‚¢ã‚¤ãƒ†ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ (ã»ã—ã®ã‚‚ã¨) -->
            <div id="item-counter">
                <span class="counter-icon">ğŸŸ¡</span>
                <span id="score-text">0</span>
            </div>

            <!-- æ˜Ÿã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ -->
            <div id="star-counter">
                <span class="counter-icon">â­</span>
                <span id="star-text">0</span>
            </div>

            <!-- HPã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ -->
            <div id="hp-counter">
            </div>

            <!-- ãƒ­ãƒ¼ãƒ‰ç”»é¢ -->
            <div id="screen-load" class="overlay">
                <div class="modal">
                    <h1>ã‚²ãƒ¼ãƒ ã‚’ã¯ã˜ã‚ã‚‹</h1>
                    <p>ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                    <label for="file-input" class="file-label">ğŸ“‚ ãƒãƒƒãƒ—(JSON)ã‚’é¸æŠ</label>
                    <input type="file" id="file-input" accept=".json">
                    
                    <!-- è­œé¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ -->
                    <div style="margin-top:15px; border-top:1px dashed #aaa; padding-top:10px;">
                        <p style="font-size:0.9rem; color:#555; margin-bottom:5px;">ã‹ãŸæŠœãã‚²ãƒ¼ãƒ ç”¨è­œé¢ (ä»»æ„)</p>
                        <label for="chart-input" class="file-label" style="background:#468; border-color:#57a; font-size:0.9rem;">ğŸ¼ è­œé¢(JSON)ã‚’é¸æŠ</label>
                        <input type="file" id="chart-input" accept=".json">
                        <div id="chart-status" style="font-size:0.8rem; color:#4a4; margin-top:5px;"></div>
                    </div>
                </div>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
            <div id="screen-gameover" class="overlay">
                <div class="modal">
                    <h1>GAME OVER</h1>
                    <p>ã‚„ã‚‰ã‚Œã¡ã‚ƒã£ãŸ...</p>
                    <button class="retry-btn" onclick="resetGame()">ğŸ”„ ã‚‚ã†ä¸€å›ï¼</button>
                </div>
            </div>

            <!-- ã‚¯ãƒªã‚¢ç”»é¢ -->
            <div id="screen-clear" class="overlay">
                <div class="modal">
                    <h2 class="clear-title">ç´ æã‚ã¤ã‚ã—ã‚…ã†ã‚Šã‚‡ã†ï¼</h2>
                    <p>ãŠã¤ã‹ã‚Œã•ã¾ï¼</p>
                    <div class="button-group">
                        <button class="retry-btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦ã•ãŒã™</button>
                        <button class="atelier-btn" onclick="goToAtelier()">å·¥æˆ¿ã¸ã‚‚ã©ã‚‹</button>
                    </div>
                </div>
            </div>

            <!-- ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆç¢ºèªç”»é¢ -->
            <div id="screen-reset-confirm" class="overlay">
                <div class="modal">
                    <h2>ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ</h2>
                    <p>ã‚ã¤ã‚ãŸç´ æã‚‚ã€æã„ãŸæ˜Ÿç©ºã‚‚<br>ã™ã¹ã¦æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ã€‚</p>
                    <div style="display:flex; justify-content:center; gap:20px; margin-top:20px;">
                        <button class="retry-btn" id="btn-reset-yes">ã¯ã„</button>
                        <button class="atelier-btn" id="btn-reset-no">ã„ã„ãˆ</button>
                    </div>
                </div>
            </div>

            <!-- ã‚¿ãƒƒãƒæ“ä½œUI -->
            <div id="ui-container">
                <div class="dpad">
                    <div style="grid-column:2; grid-row:1;"></div>
                    <div id="btn-left" class="dpad-btn">â†</div>
                    <div id="btn-down" class="dpad-btn">â†“</div>
                    <div id="btn-right" class="dpad-btn">â†’</div>
                </div>

                <div class="center-panel">
                </div>

                <div class="action-pad">
                    <div id="btn-attack" class="action-btn btn-attack">B</div>
                    <div id="btn-jump" class="action-btn btn-jump">A</div>
                </div>
            </div>

            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
            <div id="control-panel">
                <div id="btn-fullscreen" class="func-btn" title="ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³">â›¶</div>
                <div id="btn-mute" class="func-btn" title="ãƒŸãƒ¥ãƒ¼ãƒˆ">ğŸ”Š</div>
                <div id="btn-settings" class="func-btn" title="ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ">âš™ï¸</div>
            </div>

        </div>

        <script src="audio.js?v=4.0"></script>
        <script src="constants.js?v=4.0"></script>
        <script src="engine.js?v=4.1"></script>
        
        <!-- ã‚¯ãƒ©ãƒ•ãƒˆåˆ†å‰² -->
        <script src="craft_manager.js?v=4.2"></script>
        <script src="craft1.js?v=4.1"></script>
        <script src="craft2.js?v=4.2"></script>
        <script src="craft3.js?v=4.1"></script>
        <script src="craft4.js?v=4.1"></script>
        
        <!-- æ–°æ©Ÿèƒ½ -->
        <script src="sky_manager.js?v=2.0"></script>
        <script src="launch_manager.js?v=2.0"></script>
        
        <script src="game.js?v=5.0"></script>

        <script>
            // è­œé¢èª­ã¿è¾¼ã¿ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
            document.getElementById('chart-input').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (Array.isArray(data)) {
                            // CraftManagerã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
                            if (typeof CraftManager !== 'undefined') {
                                CraftManager.loadChart(data);
                                document.getElementById('chart-status').textContent = `ã€Œ${file.name}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
                            }
                        } else {
                            alert("è­œé¢ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");
                        }
                    } catch (err) {
                        console.error(err);
                        alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
                    }
                };
                reader.readAsText(file);
            });
        </script>
    </div>
</body>

</html>